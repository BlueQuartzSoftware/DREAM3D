#!/bin/bash

#------------------------------------------------------------------------------
# This Script file is AUTO generated during CMake. DO NOT EDIT this file. Your
# changes will be over written the next time CMake is run. If you need changes
# to this file then edit the original file.

echo "Installing Dependent Libraries for @linux_app_name@"

InstallPrefix="${1}"

#------------------------------------------------------------------------------
# This function copies a set of shared libraries from the original location
# into the packaging/install location
function copyLibraries()
{
	#echo "@linux_app_name@: Copy ${2} Lib/Links into Deployment Lib Directory"
	#echo "copyLibraries 1: $1"
  #echo "copyLibraries 2: $2"
  cd $1
	libs=`ls lib${2}@lib_suffix@.s*`
	for l in ${libs}
		do
		name=`basename ${l}`
    if [ ! -e "${InstallPrefix}/lib/${name}" ]; then
    echo "@linux_app_name@: Copy ${name} Lib/Link into Deployment Lib Directory" 
    cp --no-dereference ${l} ${InstallPrefix}/lib/.
    fi
	done
}

function copyQtWebEngineFile()
{
  name="$1"
  instDir="$2"
  srcDir="$3"
  if [ ! -e "${InstallPrefix}/${instDir}/${name}" ]; then
    #echo "@linux_app_name@:  Copy ${l} into Deployment Lib Directory"  
    cp --no-dereference @QM_QT_INSTALL_PREFIX@/${srcDir}/${name} ${InstallPrefix}/${instDir}/.
  fi
}

#------------------------------------------------------------------------------
# Copy the HDF5 Libraries into the Deployment location
HDF5_COMPONENTS="@HDF5_COMPONENTS@"
arr=$(echo $HDF5_COMPONENTS | tr ";" "\n")
for x in $arr
do
    copyLibraries "@HDF5_INSTALL@/lib"  "$x"
done


#------------------------------------------------------------------------------
# Copy the TBB Libraries into the Deployment location
TBB_COMPONENTS="@TBB_COMPONENTS@"
arr=$(echo $TBB_COMPONENTS | tr ";" "\n")
for x in $arr
do
    copyLibraries "@TBB_LIBRARY_DIR@"  "$x"
done


#------------------------------------------------------------------------------
# Copy the Qwt Libraries QWT_COMPONENTS the Deployment location
QWT_COMPONENTS="@QWT_COMPONENTS@"
arr=$(echo $QWT_COMPONENTS | tr ";" "\n")
for x in $arr
do
    copyLibraries "@QWT_LIB_DIR@"  "$x"
done


#------------------------------------------------------------------------------
# The list of Qt Libraries comes in as a semi-colon separated list of Qt5 Components
# where the name of the component is missing the "Qt5" part. We need to ensure that
# we are looking for the correct libraries so add the Qt5 prefix below.
QT_LIBS="@Qt5_COMPONENTS@"
arr=$(echo $QT_LIBS | tr ";" "\n")
for x in $arr
do
    copyLibraries "@QM_QT_INSTALL_PREFIX@/lib"  "Qt5$x"
done


# ----------------------------------------------------
# Copy the QtWebEngine parts of the QtWebEngineCore 
if [ "@DREAM3D_USE_QtWebEngine@" = "ON" ];
  then
    copyQtWebEngineFile "QtWebEngineProcess" "bin" "libexec"
    copyQtWebEngineFile "icudtl.dat" "bin" "."
    copyQtWebEngineFile "qtwebengine_resources.pak" "bin" "."
    if [ ! -e "${InstallPrefix}/bin/translations" ];
      then
        mkdir "${InstallPrefix}/bin/translations"
    fi

    if [ ! -e "${InstallPrefix}/bin/translations/qtwebengine_locales" ];
      then
        mkdir "${InstallPrefix}/bin/translations/qtwebengine_locales"
    fi
    cp -n -u @QM_QT_INSTALL_PREFIX@/translations/qtwebengine_locales/* ${InstallPrefix}/bin/translations/qtwebengine_locales/
fi


#------------------------------------------------------------------------------
# The list of Qt ICU Dependent Libraries comes in as a semi-colon separated list of Components
# where the name of the component is missing the "Qt5" part. We need to ensure that
# we are looking for the correct libraries so add the Qt5 prefix below.
ICU_LIBS="@Qt5_ICU_COMPONENTS@"
arr=$(echo $ICU_LIBS | tr ";" "\n")
for x in $arr
do
    copyLibraries "@QM_QT_INSTALL_PREFIX@/lib"  "$x"
done


#------------------------------------------------------------------------------
# Qt 5.5 now requires Linux to copy over the  "XcbQpa" shared library that the
# platform plugin for X-Windows requires (libqxcb.so). This library is NOT defined
# anywhere in the CMake configuration files that ship with Qt 5.5.1. Therefore
# we need to manually find the library file and copy it over. Maybe Qt 5.6 will
# fix that issue.
XCB_QPA_LIBS="Qt5XcbQpa"
copyLibraries "@QM_QT_INSTALL_PREFIX@/lib"  "$XCB_QPA_LIBS"

#------------------------------------------------------------------------------
# Now look for additional Install Scripts that need to be run. This is currently done because
# adding install rules for a non-target does not seem to work.
echo "Executing additional shell scripts....."
cd @DREAM3DProj_BINARY_DIR@/AdditionalInstallScripts
scripts=`ls *.sh`
for l in ${scripts}
do
	echo "== Executing Shell Script $l"
	/bin/bash ${l} $InstallPrefix
done

